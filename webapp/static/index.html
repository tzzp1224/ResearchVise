<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ScholarStudio Research UI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <div class="bg-layer"></div>
    <div class="app-shell">
      <header class="topbar reveal">
        <div class="brand">
          <h1>ScholarStudio</h1>
          <p>Agentic Research Console · 左侧任务+文档 / 中央聊天 / 右侧视频</p>
        </div>
        <div class="run-indicator" id="runIndicator">Idle</div>
      </header>

      <main class="layout reveal delay-1" id="mainLayout">
        <section class="panel panel-docs" id="panelDocs">
          <div class="panel-head">
            <h2>任务与文档</h2>
            <span class="pill" id="docStreamState">SSE: waiting</span>
          </div>

          <div class="task-controls">
            <form id="researchForm" class="research-form compact-form">
              <div class="input-mode-row">
                <label><input type="radio" name="inputMode" value="topic" checked />关键词</label>
                <label><input type="radio" name="inputMode" value="arxiv_url" />arXiv 链接</label>
                <label><input type="radio" name="inputMode" value="pdf_upload" />PDF 上传</label>
              </div>

              <div class="quick-run-row">
                <input id="topicInput" name="topic" type="text" placeholder="输入研究主题，例如：MCP production deployment" required />
                <input id="arxivUrlInput" name="arxiv_url" type="url" placeholder="https://arxiv.org/abs/xxxx.xxxxx" />
                <input id="pdfFileInput" name="pdf_file" type="file" accept=".pdf,application/pdf" />
                <button type="submit" id="runButton">开始</button>
              </div>
              <div class="input-hint" id="inputHint">关键词模式：输入研究主题后开始。</div>

              <details class="advanced-config" id="advancedConfig">
                <summary>运行配置（折叠）</summary>
                <div class="quick-inline">
                  <label class="toggle-inline">
                    <input id="generateVideoInput" type="checkbox" checked />
                    <span>视频</span>
                  </label>
                  <label class="toggle-inline">
                    <input id="allowCacheHitInput" type="checkbox" />
                    <span>自动命中缓存</span>
                  </label>
                  <label>
                    TTS
                    <select id="ttsProviderInput">
                      <option value="edge-tts" selected>edge-tts</option>
                      <option value="say">say</option>
                      <option value="espeak">espeak</option>
                      <option value="auto">auto</option>
                    </select>
                  </label>
                  <label>
                    语速
                    <input id="ttsSpeedInput" type="number" min="0.8" max="1.5" step="0.05" value="1.25" />
                  </label>
                </div>
                <div class="advanced-grid">
                  <label>
                    每源结果数
                    <input id="maxResultsInput" type="number" min="1" max="30" value="8" />
                  </label>
                  <label>
                    ReAct 迭代
                    <input id="iterationsInput" type="number" min="1" max="16" value="2" />
                  </label>
                  <label>
                    单工具超时(s)
                    <input id="toolTimeoutInput" type="number" min="3" max="60" value="6" />
                  </label>
                  <label>
                    ReAct思考超时(s)
                    <input id="reactThoughtTimeoutInput" type="number" min="4" max="45" value="5" />
                  </label>
                  <label>
                    搜索总预算(s)
                    <input id="timeBudgetInput" type="number" min="20" max="900" value="45" />
                  </label>
                </div>
                <fieldset class="sources-fieldset">
                  <legend>数据源</legend>
                  <label><input type="checkbox" value="arxiv" checked />ArXiv</label>
                  <label><input type="checkbox" value="arxiv_rss" checked />ArXiv RSS</label>
                  <label><input type="checkbox" value="openreview" checked />OpenReview</label>
                  <label><input type="checkbox" value="semantic_scholar" checked />Semantic Scholar</label>
                  <label><input type="checkbox" value="huggingface" checked />HuggingFace</label>
                  <label><input type="checkbox" value="github" checked />GitHub</label>
                  <label><input type="checkbox" value="stackoverflow" checked />StackOverflow</label>
                  <label><input type="checkbox" value="hackernews" checked />HackerNews</label>
                </fieldset>
              </details>
            </form>

            <section class="cache-suggest" id="cacheSuggest" hidden>
              <div class="cache-suggest-head">
                <h3>相似历史结果</h3>
                <button type="button" id="cacheRefreshBtn" class="ghost-btn">刷新</button>
              </div>
              <div class="cache-suggest-list" id="cacheSuggestList"></div>
            </section>

            <details class="activity-collapse">
              <summary>Agent Live Feed</summary>
              <ul class="activity-log" id="activityLog"></ul>
            </details>

            <details class="activity-collapse source-collapse">
              <summary>来源分布</summary>
              <div class="source-insights" id="sourceInsights">
                <div class="source-card">
                  <div class="source-title">专业证据源</div>
                  <div class="source-body" id="professionalSources">待生成</div>
                </div>
                <div class="source-card">
                  <div class="source-title">社区舆情源</div>
                  <div class="source-body" id="communitySources">待生成</div>
                </div>
              </div>
            </details>
          </div>

          <div class="docs-area">
            <div class="doc-tabs" id="docTabs"></div>
            <div class="doc-meta" id="docMeta">尚未生成文档</div>
            <div class="doc-viewer" id="docViewer">请先在左侧提交研究任务。</div>
          </div>
        </section>

        <div class="panel-resizer" id="leftResizer" role="separator" aria-orientation="vertical" tabindex="0"></div>

        <section class="panel panel-chat" id="panelChat">
          <div class="panel-head">
            <h2>Chat over KB</h2>
            <span class="pill" id="statusPill">Ready</span>
          </div>

          <div class="chat-wrap chat-main">
            <div class="chat-messages" id="chatMessages"></div>
            <form id="chatForm" class="chat-form">
              <input id="chatInput" type="text" placeholder="例如：关键风险与缓解策略是什么？" required />
              <button type="submit" id="chatButton">发送</button>
            </form>
          </div>
        </section>

        <div class="panel-resizer" id="rightResizer" role="separator" aria-orientation="vertical" tabindex="0"></div>

        <section class="panel panel-video" id="panelVideo">
          <div class="panel-head">
            <h2>视频输出</h2>
            <span class="pill" id="videoState">Pending</span>
          </div>
          <video id="videoPlayer" controls playsinline></video>
          <div class="video-meta" id="videoMeta">视频生成后会自动加载。</div>
          <div class="video-brief-wrap">
            <h3>Video Brief</h3>
            <div class="video-brief-panel" id="videoBriefPanel">等待 video brief 文档流...</div>
          </div>
          <div class="artifact-links" id="artifactLinks"></div>
          <details class="activity-collapse video-log-collapse">
            <summary>视频流水日志</summary>
            <ul class="video-log" id="videoLog"></ul>
          </details>
        </section>
      </main>
    </div>

    <div class="image-modal" id="imageModal" hidden>
      <div class="image-modal-backdrop" id="imageModalBackdrop"></div>
      <div class="image-modal-panel" role="dialog" aria-modal="true" aria-label="Image viewer">
        <div class="image-modal-toolbar">
          <div class="image-modal-title" id="imageModalTitle">Image Preview</div>
          <div class="image-modal-actions">
            <button class="ghost-btn" type="button" id="imageZoomOut">-</button>
            <input class="zoom-range" id="imageZoomRange" type="range" min="0.5" max="3" step="0.1" value="1" />
            <button class="ghost-btn" type="button" id="imageZoomIn">+</button>
            <button class="ghost-btn" type="button" id="imageModalClose">关闭</button>
          </div>
        </div>
        <div class="image-modal-stage" id="imageModalStage">
          <img id="imageModalImg" alt="preview" />
        </div>
      </div>
    </div>

    <script src="/static/app.js" defer></script>
  </body>
</html>
